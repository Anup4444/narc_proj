{% extends "basedashboard.html" %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.0/css/buttons.dataTables.min.css">
{% endblock %}

{% block content %}

{% if current_user.role == 'superuser' %}

<!-- superuser -->
<div>

    <div class="grid grid-cols-6">

        <div class=" h-full hidden md:block">
            <!-- <SideBar3/> -->
            <div class="shadow sticky top-[3.5rem]  pt-5">
                <div class="flex  items-center ml-3">
                    <div class="ml-2"><img src="{{ url_for('static', filename='images/list.png') }}" width="24" alt="">
                    </div>
                    <div class="  ml-4 font-bold text-2xl md:text-xl text-green-600">Menu</div>
                </div>
                <div class="border shadow-xl rounded-lg lg:m-4 h-[37rem]">

                    <div class=" gap-4 flex flex-col items-center mt-3 p-2  ">


                        <a href="{{url_for('dashboards.create_admin')}}"> <button
                                class="flex items-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100 md:text-[10px] lg:text-[16px] font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    lg:px-3 lg:p-3 p-1  rounded-lg ">
                                <span class="lg:mr-3 md:mr-1"><img
                                        src="{{ url_for('static', filename='images/user.png') }}" width="20 "
                                        alt=""></span>
                                Create Admin
                            </button></a>
                        <a href="{{url_for('dashboards.chart_series')}}"> <button
                                class="text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg ">
                                <span class="mr-3 "><img src="{{ url_for('static', filename='images/bar-chart.png') }}"
                                        width="20" alt=""></span>
                                View Chart
                            </button></a>
                        <a href="{{url_for('admin.form')}}"> <button
                                class="text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg ">
                                <span class="mr-3 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                        width="20" alt=""></span>
                                Setup Form
                            </button></a>



                    </div>
                </div>
            </div>
            <!-- <SideBar3/> -->

        </div>

        <div class="col-span-6 md:col-span-5">
            <!--  -->

            <div id="sidebar"
                class="flex-col z-10 mt-14 md:hidden flex sidebar bg-white text-white w-64 h-full fixed top-0 left-0 transform -translate-x-full transition duration-300 ease-in-out">
                <button id="closeSidebarButton"
                    class="ml-[14rem] mt-2 bg-red-500 hover:bg-red-700 h-6 text-white font-bold w-5  rounded">
                    X
                </button>
                <div>
                    <div class="       shadow  pt-5">
                        <div class="flex  items-center ml-3">
                            <div class="ml-2"><img src="{{ url_for('static', filename='images/list.png') }}" width="24"
                                    alt=""></div>
                            <div class="  ml-4 font-bold text-2xl  text-green-600">Menu</div>

                        </div>
                        <div class="border shadow-xl rounded-lg m-4 h-[37rem]">
                            <div class=" gap-4 flex flex-col  items-center  mt-3  p-2 ">


                                <a href="{{url_for('dashboards.create_admin')}}"> <button
                                        class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
                 font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                        <span class="mr-3"><img
                                                src="{{ url_for('static', filename='images/user.png') }}" width="20 "
                                                alt=""></span>
                                        Create Admin
                                    </button></a>
                                <a href="{{url_for('dashboards.chart_series')}}"> <button
                                        class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
                 font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                        <span class="mr-3 "><img
                                                src="{{ url_for('static', filename='images/bar-chart.png') }}"
                                                width="20" alt=""></span>
                                        View Chart
                                    </button></a>
                                <a href="{{url_for('admin.form')}}"> <button
                                        class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
                 font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                        <span class="mr-3 "><img
                                                src="{{ url_for('static', filename='images/form.png') }}" width="20"
                                                alt=""></span>
                                        Setup Form
                                    </button></a>



                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <!--  -->

            <div class="bg-gray-10 lg:m-4 p-1">
                <center>
                    <div class="mt-4 md:mt-2 flex justify-center items-center">
                        <button
                            class=" ml-3    text-sm lg:text-xl rounded-md p-2  border-2 font-semibold text-green-900"
                            onclick="showFormTable()">Total Number of Admins: <span
                                id="adminCount">{{total_admins}}</span></button>
                        <button
                            class=" ml-3    text-sm lg:text-xl rounded-md p-2  border-2 font-semibold text-green-900 "
                            onclick="showUserTable()">Total Number of Users: <span
                                id="userCount">{{total_users}}</span></button>
                    </div>
                </center>
                <!--  -->
                <div class="flex gap-4 items-center mb-4 mt-3 -ml-4 md:ml-0">


                    <button id="openSidebarButton"
                        class="md:hidden justify-center items-center flex hover:bg-gray-200 text-white font-bold py-1 px-2 rounded">
                        <div class=" pl-5 hover:w-26"><img src="{{ url_for('static', filename='images/more.png') }}"
                                width="28" alt=""></div>
                    </button>
                    <span class='font-semibold text-xl lg:text-2xl'>Welcome, {{ current_user.username }}</span>
                </div>
                <!--  -->


                <div class="bg-gray-10 border rounded-xl  p-3 m-2  md:p-2 lg:p-4 lg:mt-6" id="adminTable">
                    <span class='font-semibold  lg:text-[18px]  text-xl'>Admin List :</span>
                    <!--  -->
                    <div class="lg:mt-6 mt-2 overflow-x-auto">


                        <table id="adminDataTable" class="table-auto lg:mt-2  overflow-x-scroll  lg:w-full">
                            <!-- w-[10rem] -->
                            <thead>
                                <tr>
                                    <th class="border-gray-500 border text-[14px] md:text-sm h-10 md:px-4  md:py-2">
                                        Username </th>
                                    <th class="border-gray-500 border text-[14px] md:text-sm h-10 lg:px-4  md:py-2">
                                        Phone Number </th>
                                    <th class="border-gray-500 border text-[14px] md:text-sm h-10 lg:px-4  md:py-2">
                                        Center </th>
                                    <th class="border-gray-500 border text-[14px] md:text-sm h-10 lg:px-4  md:py-2">
                                        Email </th>
                                    <th class="border-gray-500 border text-[14px] md:text-sm h-10 lg:px-4  md:py-2">
                                        Action</th>

                                    <th class="border-gray-500 border text-[14px] md:text-sm h-10 lg:px-4  md:py-2">
                                        View </th>

                                </tr>
                            </thead>
                            <tbody>
                                {% for admin in admins %}
                                <tr>
                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{admin.username}}</td>
                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{admin.phone_number}}</td>
                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{admin.labcenter.value}}</td>
                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{admin.email}}</td>
                                    <td
                                        class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        <a href="#" class="toggle-active" data-user-id="{{ admin.id }}">
                                            {{ "Enable" if admin.is_active else "Disable" }}
                                        </a>
                                    </td>

                                    <td
                                        class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2 hover:underline">
                                        <a class="cursor-pointer" data-admin-id="{{admin.id}}"
                                            onclick="toggleView(this)">view</a></td>
                                </tr>
                                {% endfor %}





                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="bg-gray-10 border rounded-xl p-3 m-2 shadow-xl md:p-2 lg:p-3 mt-6" id="userTable">
                    <span class='font-semibold  text-[18px] text-xl  '>User List :</span>
                    <div class='lg:mt-6 mt-2 overflow-x-auto'>
                        <table id="userDataTable" class="table-auto  w-full ">
                            <thead>
                                <tr>
                                    <th class="border-gray-500 border text-sm h-10 px-4 py-2">Username</th>
                                    <th class="border-gray-500 border text-sm h-10 px-4 py-2">Phone number</th>
                                    <th class="border-gray-500 border text-sm h-10 px-4 py-2">Email</th>


                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>

            </div>

        </div>
    </div>

</div>
</div>


</div>








<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>





<script>
    document.getElementById('userTable').style.display = 'none'; // hide the user table initially

    // Initially hide the userTable

    function toggleView(element) {
        const adminId = element.getAttribute('data-admin-id');
        
        fetch(`/get-users-for-admin/${adminId}`)
            .then(response => response.json())
            .then(data => {
                let usersHTML = "";
                
                data.users.forEach(user => {
                    usersHTML += `
          <tr>
              <td class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${user.username}</td>
              <td class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${user.phone_number}</td>
              <td class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${user.email}</td>
          </tr>`;
                });
    
                // If the DataTable instance exists, destroy it
                if ($.fn.dataTable.isDataTable('#userDataTable')) {
                    $('#userDataTable').DataTable().destroy();
                }
                
                // Replace the body of the user table with the new HTML
                document.getElementById('userDataTable').querySelector('tbody').innerHTML = usersHTML;
                
                // Reinitialize the DataTable
                $('#userDataTable').DataTable();
                
                // Show the user table
                document.getElementById('userTable').style.display = 'block'; 
            })
            .catch(error => {
                console.error("Error fetching users:", error);
            });
    }
    
    $(document).ready(function () {
        $('#adminDataTable').DataTable();
        $('#userDataTable').DataTable();
    });
    // 
    document.addEventListener("DOMContentLoaded", function () {
        const openSidebarButton = document.getElementById("openSidebarButton");
        const closeSidebarButton = document.getElementById("closeSidebarButton");
        const sidebar = document.getElementById("sidebar");

        openSidebarButton.addEventListener("click", function () {
            sidebar.classList.add("translate-x-0");
        });

        closeSidebarButton.addEventListener("click", function () {
            sidebar.classList.remove("translate-x-0");
        });
    });


    document.querySelectorAll(".toggle-active").forEach(function (toggleButton) {
        toggleButton.addEventListener("click", function (e) {
            e.preventDefault();

            const userId = e.target.getAttribute('data-user-id');
            fetch(`/toggle-user-active/${userId}`, {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Update the text of the link/button to reflect the new status
                        e.target.innerText = data.is_active ? "Enable" : "Disable";
                    }
                });
        });
    });
</script>
<style>
    .btn-action {
        transition: ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 duration-100;
        font-size: large;
        font-weight: bold;
        padding: 10px 15px;
        background-color: green;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-stats {
        background-color: white;
        border: 1px solid green;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: medium;
        font-weight: bold;
        color: green;
        cursor: pointer;
    }

    .btn-stats:hover {
        background-color: green;
        color: white;
    }
</style>
<!-- superuser -->


{% elif current_user.role == 'admin' %}


<!-- admin -->


<div class="grid grid-cols-6">
    <div class=" h-full hidden md:block">
        <!-- <SideBar /> -->
        <div class="shadow sticky top-[3.5rem]  pt-5">
            <div class="flex  items-center ml-3">
                <div class="ml-2"><img src="{{ url_for('static', filename='images/list.png') }}" width="24" alt="">
                </div>
                <div class="  ml-4 font-bold text-2xl md:text-xl text-green-600">Menu</div>
            </div>
            <div class="border shadow-xl rounded-lg m-4 h-[37rem]">
                <div class=" gap-4 flex flex-col items-center mt-3  p-2 ">

                    <a href="{{url_for('dashboards.create_user')}}"> <button
                            class="md:text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg ">
                            <span class="mr-3 "><img src="{{ url_for('static', filename='images/user.png') }}"
                                    width="20" alt=""></span>
                            Create user
                        </button></a>
                    <a href="{{url_for('dashboards.chart_series')}}"> <button
                            class="text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg ">
                            <span class="mr-3 "><img src="{{ url_for('static', filename='images/bar-chart.png') }}"
                                    width="20" alt=""></span>
                            View Chart
                        </button></a>
                    <a href="{{url_for('admin.form')}}"><button
                            class="text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg ">
                            <span class="mr-3 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                    width="20" alt=""></span>
                            Setup Form
                        </button></a>
                        <a href="{{url_for('dashboards.message_list')}}"> <button
                            class="text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg">
                            <span class="mr-1 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                    width="20" alt=""></span>
                            Message list
                        </button></a>



                </div>
            </div>
        </div>

        <!-- <SideBar /> -->
    </div>

    <div class="col-span-6 md:col-span-5 p-4 md:p-0">
        <!--  -->

        <div id="sidebar"
            class="flex-col z-10 mt-14 md:hidden flex sidebar bg-white text-white w-64 h-full fixed top-0 left-0 transform -translate-x-full transition duration-300 ease-in-out">
            <button id="closeSidebarButton"
                class="ml-[14rem] mt-2 bg-red-500 hover:bg-red-700 h-6 text-white font-bold w-5  rounded">
                X
            </button>
            <div>
                <div class="       shadow  pt-5">
                    <div class="flex  items-center ml-3">
                        <div class="ml-2"><img src="{{ url_for('static', filename='images/list.png') }}" width="24"
                                alt=""></div>
                        <div class="  ml-4 font-bold text-2xl  text-green-600">Menu</div>

                    </div>
                    <div class="border shadow-xl rounded-lg m-4 h-[37rem]">
                        <div class=" gap-4 flex flex-col  items-center  mt-3  p-2 ">

                            <button
                                class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
               font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                <span class="mr-1 "><img src="{{ url_for('static', filename='images/bar-chart.png') }}"
                                        width="20" alt=""></span>
                                <a href="{{url_for('dashboards.chart_series')}}">View Chart</a>
                            </button>
                            <button
                                class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
               font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                <span class="mr-1 "><img src="{{ url_for('static', filename='images/user.png') }}"
                                        width="20" alt=""></span>
                                <a href="{{url_for('dashboards.create_user')}}">Create user</a>
                            </button>
                            <button
                                class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
               font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                <span class="mr-1 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                        width="20" alt=""></span>
                                <a href="{{url_for('admin.form')}}">Setup Form</a>
                            </button>
                            <a href="{{url_for('dashboards.message_list')}}"> <button
                                class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
       font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                <span class="mr-1 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                        width="20" alt=""></span>
                                Message list
                            </button></a>


                        </div>
                    </div>
                </div>
            </div>


        </div>
        <!--  -->
        <div class="bg-gray-10 lg:m-4 ">
            <center>
                <div class="lg:mt-4 mt-1 flex justify-center items-center">
                    <button class=" ml-3    text-sm lg:text-xl rounded-md p-2  border-2 font-semibold text-green-900"
                        onclick="showFormTable()">Total Number of Forms: <span
                            id="formCount">{{total_forms_filled}}</span></button>
                    <button class="  ml-3    text-sm lg:text-xl rounded-md p-2  border-2 font-semibold text-green-900 "
                        onclick="showUserTable()">Total Number of Users: <span
                            id="userCount">{{total_users}}</span></button>
                </div>
            </center>
            <!--  -->
            <div class="flex gap-4 mb-4 items-center -ml-4 md:ml-0">


                <button id="openSidebarButton"
                    class="md:hidden mt-4 justify-center items-center flex hover:bg-gray-200 text-white font-bold py-1 px-2 rounded">
                    <div class=" pl-2 hover:w-26"><img src="{{ url_for('static', filename='images/more.png') }}"
                            width="28" alt=""></div>
                </button>
                <!-- <div class="flex justify-between">

                    <span class="text-2xl mt-3 font-semibold">Welcome, {{ current_user.username }}!!!</span>
                    <a href="{{url_for('dashboards.send_message')}}">

                        <button id="button1" class="  text-xl font-semibold   border-2   text-green-900 py-2 px-4 rounded ">
                            Send message
                        </button>
                    </a>
        
                </div> -->
                
            </div>
               <div class="flex justify-between">

                    <span class="text-2xl mt-3 font-semibold">Welcome, {{ current_user.username }}</span>
                    <a href="{{url_for('dashboards.send_message')}}">

                        <button id="button1" class="  text-xl font-semibold   border-2   text-green-900 py-2 px-4 rounded ">
                            Send message
                        </button>
                    </a>
        
                </div>
            <!--  -->

            <!-- <div class="col-span-6 m-5 md:col-span-5"> -->
            <div class="bg-gray-10   " id="userTable">


                <!-- <span class="text-2xl font-semibold">Welcome,{{ current_user.username }}!!!</span> -->

                <div
                    class=" lg:w-full mx-auto  lg:p-4 p-2 items-center     w-full  md:mt-2 lg:pt-2 rounded-lg shadow border">
                    <span class='font-semibold  lg:text-xl text-[18px] ' id="sidebarToggle">Users List </span><br><button id="downloadBtn" style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 12px;">Excel Form</button>
                    <div class="lg:mt-6 mt-2 overflow-x-auto">


                        <table id="userDataTable" class="table-auto lg:mt-2 overflow-x-scroll   w-full  ">
                            <thead>
                                <tr>
                                    <th
                                        class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Username </th>
                                    <th
                                        class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Phone Number </th>
                                    <th
                                        class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Email </th>
                                    <th
                                        class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2 ">
                                        Action
                                    </th>
                                    <th
                                        class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2 ">
                                        View
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{user.username}}</td>
                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{user.phone_number}}</td>

                                    <td
                                        class="border  lg:text-[18px] border-gray-500 h-[1rem] text-[14px] lg:px-4  px-2 py-2">
                                        {{user.email}}</td>
                                    <td class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">
                                        <a href="#" class="toggle-active" data-user-id="{{ user.id }}">
                                            {{ "Enable" if user.is_active else "Disable" }}
                                        </a>
                                    </td>

                                    <td
                                        class=" border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2 hover:underline">
                                        <a class="cursor-pointer" data-user-id="{{ user.id }}"
                                            onclick="loadUserForms(this)">view</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


            <div id="formTable" class="hidden bg-gray-10 mt-5   lg:w-full       border-gray-500 ">
                <div class=" mx-auto bg-white p-4 rounded-lg   shadow border w-full">
                    <span class='font-semibold text-xl  '>Form List :</span>
                    <div class="mt-2 lg:mt-6 overflow-x-auto">
                        <table id="formDataTable" class="table-auto  w-full">
                            <thead>
                                <tr>
                                    <th
                                        class="border-gray-500 border text-xs lg:text-xl  font-semibold h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Field Reference ID </th>
                                    <th
                                        class="border-gray-500 border text-xs lg:text-xl  font-semibold h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Diganosis Name </th>
                                    <th
                                        class="border-gray-500 border text-xs lg:text-xl  font-semibold h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Center </th>

                                    <th
                                        class="border-gray-500 border text-xs lg:text-xl font-semibold h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Date </th>
                                    <th
                                        class="border-gray-500 border text-xs lg:text-xl  font-semibold h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Status </th>

                                    <th
                                        class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Sample Images</th>
                                    <th
                                        class="border-gray-500 border text-xs lg:text-xl  font-semibold h-10 lg:px-4 px-1 py-1 lg:py-2">
                                        Action</th>
                                </tr>
                            </thead>
                            <tbody>


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



        </div>
        <!-- <footer>

            {% include 'footer.html' %}
        </footer> -->
    </div>

</div>






<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>


<script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/buttons/2.3.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js">
</script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.1/js/buttons.html5.min.js">
</script>
<script type="text/javascript" charset="utf8"
    src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js">
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const openSidebarButton = document.getElementById("openSidebarButton");
        const closeSidebarButton = document.getElementById("closeSidebarButton");
        const sidebar = document.getElementById("sidebar");

        openSidebarButton.addEventListener("click", function () {
            sidebar.classList.add("translate-x-0");
        });

        closeSidebarButton.addEventListener("click", function () {
            sidebar.classList.remove("translate-x-0");
        });
    });


    // 
    function loadUserForms(link) {
        var userId = link.getAttribute('data-user-id');

        // AJAX call to fetch forms associated with the user
        $.ajax({
            url: `/get_user_forms/${userId}`,
            type: 'GET',
            dataType: 'json',
            success: function (forms) {



                 // Destroy the DataTable instance if exists
            if ($.fn.dataTable.isDataTable('#formDataTable')) {
                $('#formDataTable').DataTable().destroy();
            }
                // Empty the current table data
                $('#formDataTable tbody').empty();

                // Populate the table with the fetched forms
                forms.forEach(function (form) {
                    $('#formDataTable tbody').append(`
                        <tr>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.fieldreferenceid}</td>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.diagnosisname}</td>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.labcenter}</td>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.date}</td>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.status}</td>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">
                                <div style="display: flex;"> 
                                    ${form.image_path_insect || form.image_path_disease || form.image_path_weeds ? `
                                        ${form.image_path_insect ? `
                                            <a href="/${form.image_path_insect}" data-lightbox="gallery-${form.id}" title="Image of ${form.insect_name}">
                                                <img src="/${form.image_path_insect}" alt="Image of ${form.insect_name}"  style="margin-right: 10px; width:100px;height:100px;"/>
                                            </a>
                                        ` : ''}
                                        ${form.image_path_disease ? `
                                            <a href="/${form.image_path_disease}" data-lightbox="gallery-${form.id}" title="Image of ${form.disease_name}">
                                                <img src="/${form.image_path_disease}" alt="Image of ${form.disease_name}"  style="margin-right: 10px; width:100px;height:100px;"/>
                                            </a>
                                        ` : ''}
                                        ${form.image_path_weeds ? `
                                            <a href="/${form.image_path_weeds}" data-lightbox="gallery-${form.id}" title="Image of ${form.weeds_name}">
                                                <img src="/${form.image_path_weeds}" alt="Image of ${form.weeds_name}"  style="margin-right: 10px;width:100px;height:100px;"/>
                                            </a>
                                        ` : ''}
                                    ` : `
                                        <span>No Image Uploaded</span>
                                    `}
                                </div>
                            </td>
                            <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2"><a href="/edit_form/${form.id}" class="btn btn-primary btn-sm">Edit</a> | 
                            <a href="/display_and_download/${form.id}" class="btn btn-success btn-sm">View</a></td>
                        </tr>
                    `);
                });

                
            // Reinitialize DataTable
            $('#formDataTable').DataTable({order: [[3, 'desc'], [1, 'asc']]});



                // Only show form table
                $('#formTable').show();

            },
            error: function (error) {
                console.error("Failed to fetch user forms.", error);
            }
        });
    }
    $(document).ready(function () {
        $('#userDataTable').DataTable();
        $('#formDataTable').DataTable();
    });
    document.querySelectorAll(".toggle-active").forEach(function (toggleButton) {
        toggleButton.addEventListener("click", function (e) {
            e.preventDefault();

            const userId = e.target.getAttribute('data-user-id');
            fetch(`/toggle-user-active/${userId}`, {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Update the text of the link/button to reflect the new status
                        e.target.innerText = data.is_active ? "Enable" : "Disable";
                    }
                });
        });
    });
    document.addEventListener("DOMContentLoaded", function () {
        const openSidebarButton = document.getElementById("openSidebarButton");
        const closeSidebarButton = document.getElementById("closeSidebarButton");
        const sidebar = document.getElementById("sidebar");

        openSidebarButton.addEventListener("click", function () {
            sidebar.classList.add("translate-x-0");
        });

        closeSidebarButton.addEventListener("click", function () {
            sidebar.classList.remove("translate-x-0");
        });
    });
    $(document).ready(function(){
        $("#downloadBtn").on("click", function() {
            window.location.href = "/download_excel_admin";
        });
    });
</script>


<style>
    .btn-action {
        transition: ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 duration-100;
        font-size: large;
        font-weight: bold;
        padding: 10px 15px;
        background-color: green;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-stats {
        background-color: white;
        border: 1px solid green;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: medium;
        font-weight: bold;
        color: green;
        cursor: pointer;
    }

    .btn-stats:hover {
        background-color: green;
        color: white;
    }
</style>
<!-- admin end -->

{% else %}
<!-- user -->
<div class="grid grid-cols-6">
    <div class=" h-full hidden md:block">
        <!-- <SideBar3 /> -->
        <!--  -->
        <!-- <div class="mt-5 md:">

      <button class="text-black"><img src="/images/form.png" alt="">mdddddddddddddddddddddenind</button>
    </div> -->
        <!--  -->
        <div class="shadow sticky top-[3.5rem]    pt-5">
            <div class="flex  items-center ml-3">
                <div class="ml-2"><img src="{{ url_for('static', filename='images/list.png') }}" width="24" alt="">
                </div>
                <div class="  ml-4 font-bold text-2xl md:text-xl text-green-600">Menu</div>
            </div>
            <div class="border shadow-xl rounded-lg m-4 h-[37rem]">
                <div class=" gap-4 flex flex-col  items-center  mt-3  p-2 ">

                    <a href="{{url_for('dashboards.new_form')}}"> <button
                            class="md:text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
                font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg">
                            <span class="lg:mr-3  md:mr-1"><img
                                    src="{{ url_for('static', filename='images/form.png') }}" width="15" alt=""></span>
                            Add Form
                        </button></a>
                    <a href="{{url_for('dashboards.message_list')}}"> <button
                            class="md:text-[10px]  lg:text-[16px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
                font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100     lg:px-4 lg:p-3 p-1  rounded-lg">
                            <span class="lg:mr-3  md:mr-1"><img
                                    src="{{ url_for('static', filename='images/form.png') }}" width="15" alt=""></span>
                            Message list
                        </button></a>



                </div>
            </div>
        </div>
        <!-- <SideBar3 /> -->
    </div>
    <div class="col-span-6 md:col-span-5  m-3">
        <!-- <div class="w-full  bg-white md:p-6 p-3 rounded-lg shadow-xl h-[29rem] lg:h-[46rem]"> -->
        <!--  -->

        <div id="sidebar"
            class="flex-col z-10 mt-14 md:hidden flex sidebar bg-white text-white w-64 h-full fixed top-0 left-0 transform -translate-x-full transition duration-300 ease-in-out">
            <button id="closeSidebarButton"
                class="ml-[14rem] mt-2 bg-red-500 hover:bg-red-700 h-6 text-white font-bold w-5  rounded">
                X
            </button>
            <div>
                <div class="       shadow  pt-5">
                    <div class="flex  items-center ml-3">
                        <div class="ml-2"><img src="{{ url_for('static', filename='images/list.png') }}" width="24"
                                alt=""></div>
                        <div class="  ml-4 font-bold text-2xl  text-green-600">Menu</div>

                    </div>
                    <div class="border shadow-xl rounded-lg m-4 h-[37rem]">
                        <div class=" gap-4 flex flex-col  items-center  mt-3  p-2 ">

                            <a href="{{url_for('dashboards.new_form')}}"> <button
                                    class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
           font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                    <span class="mr-1 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                            width="20" alt=""></span>
                                    Add Form
                                </button></a>
                            <a href="{{url_for('dashboards.message_list')}}"> <button
                                    class=" md:text-[10px]  lg:text-[14px] flex items-center  justify-center  transition ease-in-out delay-150  hover:-translate-y-1 hover:scale-110 duration-100  
           font-semibold hover:text-black hover:bg-gray-100  border text-gray-700 bg-gray-100    px-6  p-3  rounded-lg ">
                                    <span class="mr-1 "><img src="{{ url_for('static', filename='images/form.png') }}"
                                            width="20" alt=""></span>
                                    Message list
                                </button></a>




                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!--  -->

        <div class="flex items-center gap-4 mb-4 -ml-4 md:ml-0">


            <button id="openSidebarButton"
                class="md:hidden justify-center items-center flex hover:bg-gray-200 text-white font-bold py-1 px-2 rounded">
                <div class=" pl-2 hover:w-26"><img src="{{ url_for('static', filename='images/more.png') }}" width="28"
                        alt=""></div>
            </button>

        </div>
        <div class="flex justify-between mx-4">

            <button id="button1" class="  text-xl font-semibold   border-2   text-green-900 py-2 px-4 rounded ">
                Numbers of forms: {{forms_user}}
            </button>
            <a href="{{url_for('dashboards.send_message')}}">

                <button id="button1" class="  text-xl font-semibold   border-2   text-green-900 py-2 px-4 rounded ">
                    Send message
                </button>
            </a>

        </div>



        <div id="container1" class="shadow-xl border bg-white p-4 mt-4  w-full rounded shadow">
            <div class="mb-4">

                <span class="font-semibold text-xl">Form Table</span><br><button id="downloadBtn" style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 12px;">Excel Form</button>
            </div>
            <!-- </div> -->

            <!-- <div id="container1" class="shadow-xl bg-white p-4 mt-4 lg:mt-0 w-full rounded shadow"> -->
            <table id="formDataTable" class="table-auto w-full mt-1 ">
                <thead>
                    <tr>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                            Field Reference ID</th>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                            Diagnosis Name</th>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                            Center</th>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                            Date </th>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                            Status </th>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2">
                            Sample Images</th>
                        <th
                            class="border-gray-500 border text-xs font-semibold lg:text-xl h-10 lg:px-4 px-1 py-1 lg:py-2 ">
                            Action
                        </th>

                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
            <!-- </div> -->

        </div>
    </div>
</div>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.2.0/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.2.0/js/buttons.html5.min.js"></script>

<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
<script>
    function loadUserForms() {
        // AJAX call to fetch forms for the currently logged-in user
        $.ajax({
            url: '/get_user_all_forms',
            type: 'GET',
            dataType: 'json',
            success: function (forms) {
                // Empty the current table data
                $('#formDataTable tbody').empty();

                // Populate the table with the fetched forms
                forms.forEach(function (form) {
                    $('#formDataTable tbody').append(`
                      <tr>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.fieldreferenceid}</td>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.diagnosisname}</td>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.labcenter}</td>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.date}</td>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">${form.status}</td>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">
                            <div style="display: flex;"> 
                                ${form.image_path_insect || form.image_path_disease || form.image_path_weeds ? `
                                    ${form.image_path_insect ? `
                                        <a href="/${form.image_path_insect}" data-lightbox="gallery-${form.formID}" title="Image of ${form.insect_name}">
                                            <img src="/${form.image_path_insect}" alt="Image of ${form.insect_name}" style="margin-right: 10px;width:100px;height:100px;"/>
                                        </a>
                                    ` : ''}
                                    ${form.image_path_disease ? `
                                        <a href="/${form.image_path_disease}" data-lightbox="gallery-${form.formID}" title="Image of ${form.disease_name}">
                                            <img src="/${form.image_path_disease}" alt="Image of ${form.disease_name}"  style="margin-right: 10px;width:100px;height:100px;"/>
                                        </a>
                                    ` : ''}
                                    ${form.image_path_weeds ? `
                                        <a href="/${form.image_path_weeds}" data-lightbox="gallery-${form.formID}" title="Image of ${form.weeds_name}">
                                            <img src="/${form.image_path_weeds}" alt="Image of ${form.weeds_name}"  style="margin-right: 10px;width:100px;height:100px;"/>
                                        </a>
                                    ` : ''}
                                ` : `
                                    <span>No Image Uploaded</span>
                                `}
                            </div>
                        </td>
                        <td class="border lg:text-[18px] border-gray-500 h-[1rem] text-[14px] px-4 py-2">
                            <a href="/edit_form/${form.formID}" class="btn btn-primary btn-sm">Edit</a> |
                            <a href="/display_and_download/${form.formID}" class="btn btn-success btn-sm">View</a>
                        </td>
                      </tr>
                  `);
                });

                // Re-initialize DataTable to reflect changes
                $('#formDataTable').DataTable({order: [[3, 'desc'], [1, 'asc']]});

            },

           
            error: function (error) {
                console.error("Failed to fetch user forms.", error);
            }
        });
    }




    $(document).ready(function () {
        $('#formDataTable').DataTable().clear().destroy();

        // Load user forms on page load
        loadUserForms();
    });
    // 
    // 
    document.addEventListener("DOMContentLoaded", function () {
        const openSidebarButton = document.getElementById("openSidebarButton");
        const closeSidebarButton = document.getElementById("closeSidebarButton");
        const sidebar = document.getElementById("sidebar");

        openSidebarButton.addEventListener("click", function () {
            sidebar.classList.add("translate-x-0");
        });

        closeSidebarButton.addEventListener("click", function () {
            sidebar.classList.remove("translate-x-0");
        });
    });

    $(document).ready(function(){
        $("#downloadBtn").on("click", function() {
            window.location.href = "/download_excel";
        });
    });
</script>
<!-- user -->


{% endif %}
{% endblock %}